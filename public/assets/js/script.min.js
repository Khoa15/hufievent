const socket=io(),btnJoin=document.querySelector("#btn-join"),btnCreRoom=document.querySelector("#btn-create-room"),btnOpenGame=document.querySelector("#btn-next-step"),idRoom=document.querySelector("#id-room"),username=document.querySelector("#username"),button=document.querySelectorAll("button"),gameView=document.querySelector(".game"),boardScore=document.querySelector('[view="rank"]');let roomClient={};const toggleFormData=(e=1)=>{let t=e?"unset":"none";document.querySelector("div#form-data").style.display=t},toggleLoadingBar=(e=1)=>{let t=e?"unset":"none";document.querySelector("div.loading-bar").style.display=t};function addNode(e){let t,o;return t=document.createElement("p"),o=document.createTextNode(e),t.appendChild(o),t}function showList(e){document.querySelector("#list-user-queue").innerHTML="",e.forEach(e=>null!==e&&document.querySelector("#list-user-queue").appendChild(addNode(e.name)))}document.querySelector("form.form").addEventListener("submit",e=>{e.preventDefault(),toggleFormData(0),toggleLoadingBar(),socket.emit("joinRoom",idRoom.value),socket.on("resJoinRoom",e=>{if(!1===e)return toggleFormData(),toggleLoadingBar(0),!1;document.querySelector('[step="2"]').style.display="unset",document.querySelector("h1.id-room").innerHTML="Thành công",toggleLoadingBar(0),roomClient=e})}),btnCreRoom.addEventListener("click",()=>{socket.emit("createRoom"),toggleFormData(0),toggleLoadingBar(),socket.on("roomName",e=>{document.querySelector("#next-step").style.display="unset",document.querySelector("h1.id-room").innerHTML=`${e.name}`,toggleLoadingBar(0),socket.emit("joinRoom",e.name),socket.on("resJoinRoom",e=>{roomClient=e})})}),btnOpenGame.addEventListener("click",()=>{let e=document.getElementById("username");if(0==e.value)return e.style.border="0.5px solid red",!1;e.style.border="0.5px solid black",socket.emit("openGame",roomClient._i),socket.emit("setName",{username:e.value,_index:roomClient._i}),document.querySelector("form.form").style.display="none",document.querySelector(".queue-room").classList.remove("hide"),socket.id===roomClient.player[0].id?document.querySelector(".room-status").classList.remove("hide"):document.querySelector(".room-status").innerHTML="",document.querySelector(".room-footer #room-name").innerHTML=roomClient.name}),socket.on("statusGame",e=>{roomClient.status=e}),socket.on("updateState",e=>{1===(roomClient=e).status&&showList(roomClient.player)}),document.querySelector("#btn-start-game").addEventListener("click",()=>{socket.emit("startGame",roomClient.name)}),socket.on("startGame",()=>{document.querySelector("#queue").style.display="none";const e=document.querySelector("#main-loading");e.classList.remove("hide");setTimeout(()=>{e.classList.add("hide"),gameView.classList.remove("hide"),gameStarted()},4e3)});let timeStart=0,choose=-1,round=0;function gameStarted(e=8){if(round===roomClient.questions.length)return endGame(),!0;console.log("Aswer is: "+roomClient.questions[round].qa),choose=-1;const t=document.querySelector(".title-question"),o=(document.querySelector("#list-answer"),roomClient.questions[round]),n=document.querySelectorAll("#ans");timeStart=(new Date).getTime(),t.innerHTML=`Câu ${round+1}: ${o.q}`;for(let e=0;e<o.a.length;e++)n[e].innerHTML=o.a[e];setTimeout(()=>{round++,gameStarted()},1e3*e)}const checkAns=e=>{if(-1!==choose)return!1;const t=Math.floor(1e4/((new Date).getTime()-timeStart+1)*1e3)/1e3;saveAns(choose=e.getAttribute("index"),t)};function saveAns(e,t){if(e!=roomClient.questions[round].qa)return!1;const o=roomClient.player.find(e=>e.id===socket.id);o.score+=t,o.a=[...o.a,{a:e,q:round}],socket.emit("savePlayer",{_index:roomClient._i,players:roomClient.player})}function createEle(e){return document.createElement(e)}function createText(e){return document.createTextNode(e)}function endGame(){gameView.classList.add("hide"),boardScore.classList.remove("hide");const e=roomClient.player.sort((e,t)=>t.score-e.score);let t=document.querySelector(".viewRank");t.innerHTML="";for(let o=0;o<e.length;o++){const n=createEle("tr"),r=createEle("td"),a=createEle("td"),i=createEle("td");r.appendChild(createText(o+1)),a.classList.add("text-left"),a.appendChild(createText(e[o].name)),i.appendChild(createText(e[o].score)),n.appendChild(r),n.appendChild(a),n.appendChild(i),t.appendChild(n)}}